<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('ToDo.static', filename='styles.css') }}"> 
    <title>Todo Tracker</title>
</head>
<body>
    
    <h1>New Task</h1>

    
    <form action="{{ url_for('ToDo.add_todo') }}" method="POST">
        <input type="text" name="desc" size="40" maxlength="40" placeholder="Outcome description ...:" required>
        <input type="text" id="taskCat" size="10" maxlength="10" placeholder="Project?"name="category">
        <button type="submit">Add</button>
        
        <form action="{{ url_for('ToDo.home') }}" method="GET">
            <button id="refresh-button" type="button">Refresh</button>
        </form>
    </form>

    
    <h1>Priorities (2 not 3) </h1>
    <div class="scroll-container">
        <table>
        <thead>
            <tr>
                <th>Desc</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% for t in taskList %}
            <tr data-item-id="{{ t['taskID'] }}">
                {% if t['status'] == 'Prio2not3' %}
                    
                    <td>{{ t['desc'] }}</td>
                    <td>{{ t['category'] }}</td>
                    <td><button class="action-btn" data-product-id="1">Details</button></td>

                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>
    
    <h1>My Tasks</h1>
    <div>
    <table>
        <thead>
            <tr>
                <th>Desc</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% for t in taskList %}
            <tr>
                {% if t['status'] != 'Prio2not3' and t['status'] != 'Hidden'%}
                    <td>{{ t['desc'] }}</td>
                    <td>{{ t['category'] }}</td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    <h3>Action Output:</h3>
    <p id="action-output">Select a row to see details here.</p>

    <script>
        $(document).ready(function() {
            // Add click event listener to all table rows
            $('#data-table tbody tr').on('click', function() {
                // Remove 'selected' class from any previously selected row
                $('tr').removeClass('selected');
                // Add 'selected' class to the clicked row
                $(this).addClass('selected');

                // Get the item ID from the data attribute
                const itemId = $(this).data('item-id');
                
                // Send an AJAX POST request to the Flask backend
                $.ajax({
                    url: url_for(ToDo.taskAction),
                    type: 'POST',
                    data: { taskID: itemId },
                    success: function(response) {
                        // Display the action message in the output area
                        if (response.status === 'success') {
                            $('#action-output').text(response.message);
                        } else {
                            $('#action-output').text(response.message);
                        }
                    },
                    error: function(error) {
                        console.error('Error:', error);
                        $('#action-output').text('An error occurred.');
                    }
                });
            });
        });
    </script>
</body>
</html>